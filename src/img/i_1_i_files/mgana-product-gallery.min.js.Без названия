(function(a){'use strict';var b=function(b,d){var c,e,f;if(this.$target=b,this.$images=a('.woocommerce-product-gallery__image',b),b.parent('.product--large-image').data('old_gallery')||(c=b.find('.woocommerce-product-gallery__wrapper').html(),b.parent('.product--large-image').data('old_gallery',c).data('prev_gallery',c)),b.parent('.product--large-image').data('gallery_action')||(e=b.find('.woocommerce-product-gallery__actions').clone(),e.find('.woocommerce-product-gallery__trigger').remove(),c='<div class="woocommerce-product-gallery__actions">',c+=e.html(),c+='</div>',b.parent('.product--large-image').data('gallery_action',c)),this.$target.parent().attr('data-totalG',this.$images.length),0===this.$images.length){this.$target.css('opacity',1),this.$target.parent().addClass('no-gallery');return}1===this.$images.length?this.$target.parent().addClass('no-gallery'):this.$target.parent().removeClass('no-gallery'),b.data('product_gallery',this),this.flexslider_enabled=!0,(b.hasClass('no-slider-script')||b.hasClass('force-disable-slider-script'))&&(this.flexslider_enabled=!1),this.zoom_enabled=a.isFunction(a.fn.zoom)&&wc_single_product_params.zoom_enabled,this.photoswipe_enabled=typeof PhotoSwipe!='undefined'&&wc_single_product_params.photoswipe_enabled,d&&(this.flexslider_enabled=!1!==d.flexslider_enabled&&this.flexslider_enabled,this.zoom_enabled=!1!==d.zoom_enabled&&this.zoom_enabled,this.photoswipe_enabled=!1!==d.photoswipe_enabled&&this.photoswipe_enabled),b.hasClass('force-disable-slider-script')&&(this.flexslider_enabled=!1),this.thumb_verital=!1,this.$images.length<2&&(this.flexslider_enabled=!1);try{la_theme_config.product_single_design==2&&(this.thumb_verital=!0)}catch(a){this.thumb_verital=!1}this.parent_is_quickview=!1,b.closest('.featherlight').length&&(this.thumb_verital=!0,this.parent_is_quickview=!0),this.initSlickslider=this.initSlickslider.bind(this),this.initZoom=this.initZoom.bind(this),this.initPhotoswipe=this.initPhotoswipe.bind(this),this.onResetSlidePosition=this.onResetSlidePosition.bind(this),this.getGalleryItems=this.getGalleryItems.bind(this),this.openPhotoswipe=this.openPhotoswipe.bind(this),this.flexslider_enabled?a.isFunction(a.fn.slick)?(this.initSlickslider(),b.on('woocommerce_gallery_reset_slide_position',this.onResetSlidePosition)):(f=this,LaStudio.core.loadDependencies([LaStudio.global.loadJsFile('jquery.slick')],function(){f.initSlickslider(),b.on('woocommerce_gallery_reset_slide_position',f.onResetSlidePosition)})):(this.parent_is_quickview?a('body').removeClass('lightcase--pending').addClass('lightcase--completed'):setTimeout(function(){a('body').trigger("la_sticky:recalc")},200),this.$target.css('opacity',1),b.removeClass('la-rebuild-product-gallery').parent().removeClass('swatch-loading')),this.zoom_enabled&&(this.initZoom(),b.on('woocommerce_gallery_init_zoom',this.initZoom)),this.photoswipe_enabled&&this.initPhotoswipe()};b.prototype.initSlickslider=function(){var l=this.$images,c=this.$target,f=c.find('.woocommerce-product-gallery__wrapper'),e=c.parent().find('.la-thumb-inner'),k=Math.floor(Math.random()*100+1),i='la_woo_thumb_'+k,h='la_woo_target_'+k,j=this.parent_is_quickview,b,g,d;f.attr('id',h),e.attr('id',i),l.each(function(){var b=a(this),c=b.find('a[data-videolink]').data('videolink'),g=f.css('height'),d='<div class="la-thumb"><img src="'+b.attr('data-thumb')+'"/></div>';typeof c!='undefined'&&c&&(b.unbind('click'),b.find('.zoomImg').css({display:'none!important'}),c.indexOf("http://selfhosted/")==0?(c=c.replace('http://selfhosted/',''),d='<div class="la-thumb has-thumb-video"><div><img src="'+b.attr('data-thumb')+'"/><span class="play-overlay"><i class="fa fa-play-circle-o" aria-hidden="true"></i></span></div></div>',b.append('<video class="selfhostedvid  noLightbox" width="460" height="315" controls preload="auto"><source src="'+c+'" /></video>'),b.attr('data-video','<div class="la-media-wrapper"><video class="selfhostedvid  noLightbox" width="460" height="315" controls preload="auto"><source src="'+c+'" /></video></div>')):(d='<div class="la-thumb has-thumb-video"><div><img src="'+b.attr('data-thumb')+'"/><span class="play-overlay"><i class="fa-play-circle-o"></i></span></div></div>',b.append('<iframe src ="'+c+'" width="460" " style="height:'+g+'; z-index:999999;" frameborder="no"></iframe>'),b.attr('data-video','<div class="la-media-wrapper"><iframe src ="'+c+'" width="980" height="551" frameborder="no" allowfullscreen></iframe></div>')),b.find('img').css({opacity:'0','z-index':'-1'}),b.find('iframe').next().remove()),e.append(d)}),b=a.extend({mobile:3,mobile_landscape:3,tablet:3,laptop:3,desktop:3},JSON.parse(la_theme_config.product_gallery_column)||{}),g={infinite:!1,slidesToShow:parseInt(b.desktop),slidesToScroll:1,asNavFor:'#'+h,dots:!1,arrows:!0,focusOnSelect:!0,prevArrow:'<span class="slick-prev"><i class="lastudioicon-left-arrow"></i></span>',nextArrow:'<span class="slick-next"><i class="lastudioicon-right-arrow"></i></span>',vertical:this.thumb_verital,responsive:[{breakpoint:1500,settings:{vertical:this.thumb_verital,slidesToShow:parseInt(b.laptop)}},{breakpoint:1300,settings:{vertical:this.thumb_verital,slidesToShow:parseInt(b.tablet)}},{breakpoint:800,settings:{vertical:!1,slidesToShow:parseInt(b.mobile_landscape)}},{breakpoint:577,settings:{vertical:!1,slidesToShow:parseInt(b.mobile)}}]},this.thumb_verital||(g.infinite=!1,g.centerMode=!1,g.centerPadding='0px'),d={infinite:!1,swipe:!0,slidesToShow:1,slidesToScroll:1,arrows:!0,asNavFor:'#'+i,prevArrow:'<span class="slick-prev"><i class="lastudioicon-left-arrow"></i></span>',nextArrow:'<span class="slick-next"><i class="lastudioicon-right-arrow"></i></span>',adaptiveHeight:la_theme_config.product_single_design==1},this.thumb_verital||(d.infinite=!1),la_theme_config.product_single_design!=5?e.slick(g):(j&&(b={mobile:1,mobile_landscape:1,tablet:1,laptop:1,desktop:1}),d.slidesToShow=parseInt(b.desktop),d.slidesToScroll=1,d.asNavFor='',d.responsive=[{breakpoint:1500,settings:{vertical:this.thumb_verital,slidesToShow:parseInt(b.laptop)}},{breakpoint:1300,settings:{vertical:!1,slidesToShow:parseInt(b.tablet)}},{breakpoint:800,settings:{vertical:!1,slidesToShow:parseInt(b.mobile_landscape)}},{breakpoint:577,settings:{vertical:!1,slidesToShow:parseInt(b.mobile)}}]),f.slick(d),LaStudio.global.LazyLoad(c.parent(),{rootMargin:'100px',load:function(){},complete:function(){LaStudio.global.eventManager.publish('LaStudio:Component:LazyLoadImage',[c.parent()]),c.css('opacity',1),la_theme_config.product_single_design!=5&&e.slick('setPosition'),c.parent().removeClass('swatch-loading'),j?setTimeout(function(){f.resize(),setTimeout(function(){a('body').removeClass('lightcase--pending').addClass('lightcase--completed')},50)},150):setTimeout(function(){a('body').trigger("la_sticky:recalc")},200)}}).observe()},b.prototype.initZoom=function(){this.initZoomForTarget(this.$images)},b.prototype.initZoomForTarget=function(c){if(!this.zoom_enabled)return!1;var e=this.$target.width(),d=!1,b;if(a(c).each(function(f,b){var c=a(b).find('img');if(c.data('large_image_width')>e)return d=!0,!1}),d){try{b=a.extend({touch:!1},wc_single_product_params.zoom_options)}catch(a){b={touch:!1}}'ontouchstart'in document.documentElement&&(b.on='click'),c.trigger('zoom.destroy'),c.zoom(b)}},b.prototype.initPhotoswipe=function(){this.zoom_enabled&&this.$images.length>0&&(this.$target.find('.woocommerce-product-gallery__actions').prepend('<a href="#" class="woocommerce-product-gallery__trigger"><span><i class="lastudioicon-full-screen"></i></span></a>'),this.$target.on('click','.woocommerce-product-gallery__trigger',this.openPhotoswipe)),this.$target.on('click','.woocommerce-product-gallery__image a',this.openPhotoswipe)},b.prototype.onResetSlidePosition=function(){this.$target.parent().removeClass('swatch-loading'),this.$target.find('.woocommerce-product-gallery__wrapper').slick('slickGoTo',0)},b.prototype.getGalleryItems=function(){var b=this.$images,c=[];return b.length>0&&b.each(function(i,d){var b=a(d).find('img'),f=b.attr('data-large_image'),g=b.attr('data-large_image_width'),h=b.attr('data-large_image_height'),e={src:f,w:g,h,title:b.attr('title')};a(d).attr('data-video')&&(e={html:a(d).attr('data-video')}),c.push(e)}),c},b.prototype.openPhotoswipe=function(d){var e,f,c,b,g,h;d.preventDefault(),e=a('.pswp')[0],f=this.getGalleryItems(),c=a(d.target),c.is('.woocommerce-product-gallery__trigger')?b=this.$target.find('.slick-current'):b=c.closest('.woocommerce-product-gallery__image'),g={index:a(b).index(),shareEl:!1,closeOnScroll:!1,history:!1,hideAnimationDuration:0,showAnimationDuration:0},h=new PhotoSwipe(e,PhotoSwipeUI_Default,f,g),h.init()},a.fn.lastudio_product_gallery=function(a){return new b(this,a),this}})(jQuery)