(function(a){typeof define=='function'&&define.amd?define(['jquery'],a):typeof module=='object'&&module.exports?module.exports=function(c,b){return b===void 0&&(typeof window!='undefined'?b=require('jquery'):b=require('jquery')(c)),a(b),b}:a(jQuery)})(function(a){"use strict";var c,d,g,e,h,f;if('undefined'==typeof a){'console'in window&&window.console.info('Too much lightness, Featherlight needs jQuery.');return}if(a.fn.jquery.match(/-ajax/)){'console'in window&&window.console.info('Featherlight needs regular jQuery, not the slim version.');return}function b(a,c){if(this instanceof b)this.id=b.id++,this.setup(a,c),this.chainCallbacks(b._callbackChain);else{var d=new b(a,c);return d.open(),d}}c=[],d=function(b){return c=a.grep(c,function(a){return a!==b&&a.$instance.closest('body').length>0}),c};function i(b,d){var c={},a;for(a in b)a in d&&(c[a]=b[a],delete b[a]);return c}g={allow:1,allowfullscreen:1,frameborder:1,height:1,longdesc:1,marginheight:1,marginwidth:1,mozallowfullscreen:1,name:1,referrerpolicy:1,sandbox:1,scrolling:1,src:1,srcdoc:1,style:1,webkitallowfullscreen:1,width:1};function j(b,e){var c={},f=new RegExp('^'+e+'([A-Z])(.*)'),d,a,g;for(d in b)a=d.match(f),a&&(g=(a[1]+a[2].replace(/([A-Z])/g,'-$1')).toLowerCase(),c[g]=b[d]);return c}e={keyup:'onKeyUp',resize:'onResize'},h=function(c){a.each(b.opened().reverse(),function(){if(!c.isDefaultPrevented()){if(!1===this[e[c.type]](c))return c.preventDefault(),c.stopPropagation(),!1}})},f=function(c){if(c!==b._globalHandlerInstalled){b._globalHandlerInstalled=c;var d=a.map(e,function(c,a){return a+'.'+b.prototype.namespace}).join(' ');a(window)[c?'on':'off'](d,h)}},b.prototype={constructor:b,namespace:'featherlight',targetAttr:'data-featherlight',variant:null,resetCss:!1,background:null,openTrigger:'click',closeTrigger:'click',filter:null,root:'body',openSpeed:250,closeSpeed:250,closeOnClick:'background',closeOnEsc:!0,closeIcon:'&#10005;',loading:'',persist:!1,otherClose:null,beforeOpen:a.noop,beforeContent:a.noop,beforeClose:a.noop,afterOpen:a.noop,afterContent:a.noop,afterClose:a.noop,onKeyUp:a.noop,onResize:a.noop,type:null,contentFilters:['jquery','image','html','ajax','iframe','text'],setup:function(c,e){typeof c=='object'&&c instanceof a===!1&&!e&&(e=c,c=void 0);var b=a.extend(this,e,{target:c}),d=b.resetCss?b.namespace+'-reset':b.namespace,f=a(b.background||['<div class="'+d+'-loading '+d+'">','<div class="'+d+'-content">','<button class="'+d+'-close-icon '+b.namespace+'-close" aria-label="Close">',b.closeIcon,'</button>','<div class="'+b.namespace+'-inner">'+b.loading+'</div>','</div>','</div>'].join('')),g='.'+b.namespace+'-close'+(b.otherClose?','+b.otherClose:'');return b.$instance=f.clone().addClass(b.variant),b.$instance.on(b.closeTrigger+'.'+b.namespace,function(c){if(c.isDefaultPrevented())return;var d=a(c.target);('background'===b.closeOnClick&&d.is('.'+b.namespace)||'anywhere'===b.closeOnClick||d.closest(g).length)&&(b.close(c),c.preventDefault())}),this},getContent:function(){var d,e,h,i,b,c,g,f;if(this.persist!==!1&&this.$content)return this.$content;if(d=this,e=this.constructor.contentFilters,h=function(a){return d.$currentTarget&&d.$currentTarget.attr(a)},i=h(d.targetAttr),b=d.target||i||'',c=e[d.type],!c&&b in e&&(c=e[b],b=d.target&&i),b=b||h('href')||'',!c)for(g in e)d[g]&&(c=e[g],b=d[g]);if(!c){if(f=b,b=null,a.each(d.contentFilters,function(){return c=e[this],c.test&&(b=c.test(f)),!b&&c.regex&&f.match&&f.match(c.regex)&&(b=f),!b}),!b)return'console'in window&&window.console.error('Featherlight: no content filter found '+(f?' for "'+f+'"':' (no target specified)')),!1}return c.process.call(d,b)},setContent:function(b){return this.$instance.removeClass(this.namespace+'-loading'),this.$instance.toggleClass(this.namespace+'-iframe',b.is('iframe')),this.$instance.find('.'+this.namespace+'-inner').not(b).slice(1).remove().end().replaceWith(a.contains(this.$instance[0],b[0])?'':b),this.$content=b.addClass(this.namespace+'-inner'),this},open:function(d){var b=this,e;if(b.$instance.hide().appendTo(b.root),(!d||!d.isDefaultPrevented())&&b.beforeOpen(d)!==!1){if(d&&d.preventDefault(),e=b.getContent(),e)return c.push(b),f(!0),b.$instance.fadeIn(b.openSpeed),b.beforeContent(d),a.when(e).always(function(a){a&&(b.setContent(a),b.afterContent(d))}).then(b.$instance.promise()).done(function(){b.afterOpen(d)})}return b.$instance.detach(),a.Deferred().reject().promise()},close:function(e){var b=this,c=a.Deferred();return b.beforeClose(e)===!1?c.reject():(0===d(b).length&&f(!1),b.$instance.fadeOut(b.closeSpeed,function(){b.$instance.detach(),b.afterClose(e),c.resolve()})),c.promise()},resize:function(c,a){if(c&&a){this.$content.css('width','').css('height','');var b=Math.max(c/(this.$content.parent().width()-1),a/(this.$content.parent().height()-1));b>1&&(b=a/Math.floor(a/b),this.$content.css('width',''+c/b+'px').css('height',''+a/b+'px'))}},chainCallbacks:function(c){for(var b in c)this[b]=a.proxy(c[b],this,a.proxy(this[b],this))}},a.extend(b,{id:0,autoBind:'[data-featherlight]',defaults:b.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(b){return b instanceof a&&b},process:function(b){return this.persist!==!1?a(b):a(b).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff?|bmp|svg)(\?\S*)?$/i,process:function(e){var f=this,d=a.Deferred(),b=new Image,c=a('<img src="'+e+'" alt="" class="'+f.namespace+'-image" />');return b.onload=function(){c.naturalWidth=b.width,c.naturalHeight=b.height,d.resolve(c)},b.onerror=function(){d.reject(c)},b.src=e,d.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(b){return a(b)}},ajax:{regex:/./,process:function(c){var e=this,b=a.Deferred(),d=a('<div></div>').load(c,function(c,a){a!=="error"&&b.resolve(d.contents()),b.reject()});return b.promise()}},iframe:{process:function(e){var b=new a.Deferred,c=a('<iframe/>'),d=j(this,'iframe'),f=i(d,g);return c.hide().attr('src',e).attr(f).css(d).on('load',function(){b.resolve(c.show())}).appendTo(this.$instance.find('.'+this.namespace+'-content')),b.promise()}},text:{process:function(b){return a('<div>',{text:b})}}},functionAttributes:['beforeOpen','afterOpen','beforeContent','afterContent','beforeClose','afterClose'],readElementConfig:function(b,d){var e=this,f=new RegExp('^data-'+d+'-(.*)'),c={};return b&&b.attributes&&a.each(b.attributes,function(){var d=this.name.match(f),b,g;if(d){if(b=this.value,g=a.camelCase(d[1]),a.inArray(g,e.functionAttributes)>=0)b=new Function(b);else try{b=JSON.parse(b)}catch(a){}c[g]=b}}),c},extend:function(b,d){var c=function(){this.constructor=b};return c.prototype=this.prototype,b.prototype=new c,b.__super__=this.prototype,a.extend(b,this,d),b.defaults=b.prototype,b},attach:function(f,e,b){var c=this,i,d,g,h;return typeof e=='object'&&e instanceof a===!1&&!b&&(b=e,e=void 0),b=a.extend({},b),i=b.namespace||c.defaults.namespace,d=a.extend({},c.defaults,c.readElementConfig(f[0],i),b),h=function(i){var j=a(i.currentTarget),k=a.extend({$source:f,$currentTarget:j},c.readElementConfig(f[0],d.namespace),c.readElementConfig(i.currentTarget,d.namespace),b),h=g||j.data('featherlight-persisted')||new c(e,k);h.persist==='shared'?g=h:h.persist!==!1&&j.data('featherlight-persisted',h),k.$currentTarget.blur&&k.$currentTarget.blur(),h.open(i)},f.on(d.openTrigger+'.'+d.namespace,d.filter,h),{filter:d.filter,handler:h}},current:function(){var a=this.opened();return a[a.length-1]||null},opened:function(){var b=this;return d(),a.grep(c,function(a){return a instanceof b})},close:function(b){var a=this.current();if(a)return a.close(b)},_onReady:function(){var b=this,c;b.autoBind&&(c=a(b.autoBind),c.each(function(){b.attach(a(this))}),a(document).on('click',b.autoBind,function(d){var e,g,f;if(d.isDefaultPrevented())return;if(e=a(d.currentTarget),g=c.length,c=c.add(e),g===c.length)return;f=b.attach(e),(!f.filter||a(d.target).parentsUntil(e,f.filter).length>0)&&f.handler(d)}))},_callbackChain:{onKeyUp:function(c,b){return 27===b.keyCode?(this.closeOnEsc&&a.featherlight.close(b),!1):c(b)},beforeOpen:function(b,c){return a(document.documentElement).addClass('with-featherlight'),this._previouslyActive=document.activeElement,this._$previouslyTabbable=a("a, input, select, textarea, iframe, button, iframe, [contentEditable=true]").not('[tabindex]').not(this.$instance.find('button')),this._$previouslyWithTabIndex=a('[tabindex]').not('[tabindex="-1"]'),this._previousWithTabIndices=this._$previouslyWithTabIndex.map(function(c,b){return a(b).attr('tabindex')}),this._$previouslyWithTabIndex.add(this._$previouslyTabbable).attr('tabindex',-1),document.activeElement.blur&&document.activeElement.blur(),b(c)},afterClose:function(c,d){var e=c(d),f=this;return this._$previouslyTabbable.removeAttr('tabindex'),this._$previouslyWithTabIndex.each(function(b,c){a(c).attr('tabindex',f._previousWithTabIndices[b])}),this._previouslyActive.focus(),b.opened().length===0&&a(document.documentElement).removeClass('with-featherlight'),e},onResize:function(a,b){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),a(b)},afterContent:function(b,a){var c=b(a);return this.$instance.find('[autofocus]:not([disabled])').focus(),this.onResize(a),c}}}),a.featherlight=b,a.fn.featherlight=function(a,c){return b.attach(this,a,c),this},a(document).ready(function(){b._onReady()})})